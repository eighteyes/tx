# Active Mesh List Template

## Overview

The `active-mesh-list.md` template dynamically generates a list of currently active meshes and agents available in the system. This template is automatically injected into agent prompts that have the `ask` capability enabled.

## Purpose

When an agent has the `ask` capability, they need to know:
1. Which other meshes are currently active
2. Which agents are available in each mesh
3. What each agent is currently working on
4. The correct format for asking questions to other agents

The template provides this information in a clear, structured format.

## Implementation

### Files Created/Modified

1. **Created**: `meshes/prompts/templates/active-mesh-list.md`
   - Template file with `{{activeMeshList}}` placeholder
   - Includes instructions on how to create ask messages
   - Provides example ask message format

2. **Modified**: `lib/prompt-builder.js`
   - Added `_generateActiveMeshList()` static method (line 571-665)
   - Added template variable injection for `{{activeMeshList}}` (line 595-604)

### Template Integration

The ask capability references this template in `meshes/prompts/capabilities/ask/config.json`:

```json
{ "templates": ["active-mesh-list"] }
```

When PromptBuilder.build() is called for an agent with the ask capability:
1. It loads the capability's config
2. Finds the `active-mesh-list` template reference
3. Loads `meshes/prompts/templates/active-mesh-list.md`
4. Injects template variables (specifically `{{activeMeshList}}`)
5. Includes the rendered template in the agent's full prompt

### Template Variable: activeMeshList

The `{{activeMeshList}}` variable is dynamically generated by `_generateActiveMeshList()` and includes:

- **Mesh Name** - The name of the active mesh
- **Mesh Description** - From mesh config (if available)
- **Agent List** - All agents in the mesh
  - Full path format: `mesh/agent`
  - Agent description from config
  - Current task the agent is working on

**Example Output:**

```
### Mesh: `research` - Research project mesh

- **`research/searcher`** - Finds sources and references
  - Currently: 2025-10-20T07-15-30-search-climate-change.md

- **`research/analyzer`** - Analyzes and synthesizes findings
```

### How Agents Use This

When an agent with the ask capability is spawned:

1. It receives the active mesh list in its prompt preamble
2. It can see which other agents are available
3. It can format ask messages correctly using the `{mesh}/{agent}` format
4. It understands what each agent is currently working on

Example ask message:
```markdown
---
from: research/searcher
to: research/analyzer
type: ask
msg-id: q-verify-sources
status: pending
timestamp: 2025-10-20T12:00:00Z
---

# Question

Can you verify these 5 sources are peer-reviewed?
```

## Benefits

✅ **Dynamic**: Updates automatically as meshes/agents spawn or stop
✅ **Contextual**: Agents know exactly who to ask and what they're doing
✅ **Discoverable**: No need to manually maintain agent lists
✅ **Integrated**: Works seamlessly with the ask capability workflow
✅ **Fallback-safe**: Shows "No active meshes" if nothing is running

## Future Enhancements

- [ ] Show agent status (busy/idle)
- [ ] Show estimated response time based on queue
- [ ] Include agent specialties/tags for easier discovery
- [ ] Show agent availability windows
- [ ] Add agent contact preferences (e.g., urgent queries only)

## Testing

To verify the template is working:

1. **Without active agents**: Spawn an agent with ask capability → should see "No active meshes"
2. **With active agents**: Spawn multiple agents → should see all agents listed
3. **With tasks**: Verify current task shows for each agent
4. **Configuration**: Check agent descriptions appear from config files
